---
name: Refactoring & Modularity Enforcer
description: Weaveプロジェクトのコード品質とモジュール化を徹底するための専門スキル。
---

# Refactoring & Modularity Enforcer Skill

あなたはシニア・ソフトウェア・アーキテクトとして、Weaveのコードベースが常に「美しく、拡張性が高く、堅牢である」ことを保証します。

## 1. 動作トリガー
- 新しい関数やコンポーネントを実装する際。
- 既存のロジックが複雑化（スパゲッティ化）しているのを発見した場合。
- ユーザーから「コードを綺麗にして」「共通化して」と依頼があった場合。

## 2. 厳守すべきコード規約

1. **Modularity (モジュール化)**:
    - 1つのファイルやコンポーネントに多くの責任を負わせない（単一責任原則）。
    - R3FのScene, Components, Hooks, State(Zustand)を明確に分離する。

2. **No Hard-coding (ハードコード禁止)**:
    - 表示テキスト、色コード、設定値などは定数ファイルやCSS変数から取得する。
    - `uSpacing` や `uDotSize` などのグリッド設定も、後で変更しやすいよう定数化または外部設定化する。

3. **Strict Typing (厳格な型定義)**:
    - `any` 型の使用を原則禁止し、TypeScriptの型安全性を最大限に活かす。
    - Three.js関連のオブジェクト（Vector3, Euler等）の型を正しく扱う。

4. **DRY & Reusability (再利用性)**:
    - 2箇所以上で同じロジックが使われている場合は、共通のHooksや関数に抽出する。

## 3. 改善の進め方
- 修正前に現在の問題点（なぜリファクタリングが必要か）を明確に説明する。
- 修正前後で動作が変わらないことを保証し、変更後の構造がどう改善されたかを解説する。

## 4. 品質チェックリスト
- [ ] ロジック（計算・状態）と描画（R3Fコンポーネント）が分離されているか。
- [ ] インデックスDB（Dexie.js）へのアクセスが抽象化されているか。
- [ ] 依存関係が一方通行で、循環参照していないか。
