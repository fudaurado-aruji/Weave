# 実装計画: Transform Controls

## 1. 概要
オブジェクトをマウスで自由に配置・解像度変更できるようにします。R3F のネイティブイベントと Zustand ストアを組み合わせ、スムーズで永続的な操作感を実現します。

## 2. 実装ステップ
- **Step 1: Simple Dragging (Movement)**
    - `WorldObjectRenderer` にドラッグ状態を管理する `useState` を追加。
    - `onPointerDown`, `onPointerMove`, `onPointerUp` を使い、マウスの移動量（ワールド座標）に応じて `object.position` を更新するアクションを呼ぶ。

- **Step 2: Resize Handles (Visuals)**
    - 現在の赤い（またはゴールドの）3Dバウンディングボックスの四隅に、白い円形の「ハンドル」メッシュを追加。
    - ハンドルは `group` の子として配置し、常にバウンディングボックスのコーナーに位置するようにする。

- **Step 3: Scaling Logic**
    - 各ハンドルに `onPointerDown` イベントを付与。
    - どのハンドルが掴まれたかを判定し、マウス移動量に応じて `object.scale` と `object.position` を連動させて計算（アスペクト比固定のオプションなども考慮）。

- **Step 4: Persistence & Optimization**
    - ドラッグ中および終了時に `updateObject` を呼び出し、IndexedDB へ保存。
    - 描画パフォーマンスを維持するため、更新頻度の最適化を検討。

## 3. 技術的詳細
- **座標空間**: マウスのスクリーン座標を `useThree` のカメラ情報を使ってワールド座標に変換して計算。
- **カリング防止**: 操作中にオブジェクトがカメラから外れても消えないように配慮。

## 4. 検証項目
- [ ] オブジェクトを掴んでスムーズに移動できるか。
- [ ] 四隅のハンドルをドラッグしてサイズを変更できるか。
- [ ] 操作した結果がリロード後も維持されているか。
- [ ] 複数のオブジェクトがある場合でも、選択中のものだけが動くか。
